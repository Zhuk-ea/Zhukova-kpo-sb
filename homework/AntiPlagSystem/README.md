# AntiPlagiarism System

Микросервисная система для обнаружения плагиата в студенческих работах.

## Архитектура

Система состоит из трех микросервисов:

1. **API Gateway** (порт 8080) - единая точка входа для всех запросов
2. **File Storing Service** (порт 8081) - хранение студенческих работ
3. **File Analysis Service** (порт 8082) - анализ работ на плагиат

## Технологический стек

- **Java 21** с Spring Boot 3
- **Spring Cloud Gateway** для маршрутизации
- **PostgreSQL 15** для хранения данных
- **Docker & Docker Compose** для контейнеризации
- **Gradle** для сборки

## Функциональность

### Для студентов:
- Отправка работ на проверку с указанием автора и задания
- Автоматическая фиксация времени сдачи

### Для преподавателей:
- Получение аналитики по контрольным работам
- Проверка работ на плагиат
Просмотр отчетов по каждой работе

### Алгоритм обнаружения плагиата:
- Работа считается плагиатом, если существует более ранняя сдача другой работы с идентичным текстом
- Сравнение производится после очистки текста (удаление лишних пробелов, нормализация переносов строк)
- Учитывается только плагиат в рамках одного задания

## Быстрый старт

### 1. Клонирование и сборка
```bash
git clone <репозиторий>
cd AntiPlagSystem
./rebuild_and_run.sh
```

### 2. Запуск тестов
```bash
chmod +x test.sh
./test.sh
```

### 3. Использование API

Все запросы выполняются через Gateway: `http://localhost:8080`

#### Отправить работу на проверку
```bash
curl -X POST "http://localhost:8080/api/works" \
  -H "Content-Type: application/json" \
  -d '{
    "studentName": "Иванов Иван",
    "taskId": "kpo-hw-3",
    "fileName": "homework.txt",
    "content": "Текст работы..."
  }'
```

#### Получить отчет по работе
```bash
curl "http://localhost:8080/api/reports/work/{workId}"
```

#### Получить информацию о работе
```bash
curl "http://localhost:8080/api/works/{workId}"
```

#### Получить все работы по заданию
```bash
curl "http://localhost:8080/api/works/task/{taskId}"
```

## Маршрутизация

- `/api/works/**` → File Storing Service (8081)
- `/api/reports/**` → File Analysis Service (8082)

## Docker Compose

Система разворачивается одной командой:
```bash
docker-compose up --build -d
```

Сервисы:
- PostgreSQL: `postgres:15-alpine` (порт 5432)
- API Gateway: порт 8080
- File Storing Service: порт 8081
- File Analysis Service: порт 8082

## Сценарии использования

### 1. Сдача работы студентом
1. Студент отправляет работу через Gateway
2. Система сохраняет работу в PostgreSQL
3. Автоматически запускается анализ на плагиат
4. Студент получает подтверждение о приеме работы

### 2. Проверка плагиата преподавателем
1. Преподаватель запрашивает отчет по работе
2. Система возвращает результат анализа
3. При обнаружении плагиата указывается источник

### 3. Аналитика по заданию
1. Преподаватель запрашивает все работы по заданию
2. Система возвращает список работ с отчетами
3. Преподаватель видит статистику по плагиату

## Особенности реализации

- Автоматическая проверка при загрузке работы
-  Сохранение данных в PostgreSQL (сохранность при перезапуске)
- Микросервисная архитектура с четким разделением ответственности
- Единая точка входа через API Gateway
- Контейнеризация с Docker Compose
- Обработка ошибок и логирование

## Примеры ответов

### Успешная отправка работы
```json
{
  "id": 1,
  "message": "Work submitted successfully",
  "submissionTime": "2025-12-11T08:44:49.179261"
}
```

### Отчет об анализе (без плагиата)
```json
{
  "id": 1,
  "workId": 1,
  "plagiarizedFromWorkId": null,
  "status": "COMPLETED",
  "plagiarismDetected": false,
  "details": "✅ Плагиат не обнаружен. Работа уникальна.",
  "analysisTime": "2025-12-11T08:44:49.775152"
}
```

### Отчет об анализе (плагиат обнаружен)
```json
{
  "id": 2,
  "workId": 2,
  "plagiarizedFromWorkId": 1,
  "status": "COMPLETED",
  "plagiarismDetected": true,
  "details": "⚠️ ОБНАРУЖЕН ПЛАГИАТ!\nРабота #2 (сдана 08:44:52) скопирована с работы #1 (сдана 08:44:49)\nТекст полностью совпадает.",
  "analysisTime": "2025-12-11T08:44:52.099518"
}
```